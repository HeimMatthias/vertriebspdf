<!DOCTYPE html>
<html>
  <title>Vertriebs-PDF Linkcleaner</title>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
  />

  <style>
    table:has(tbody:empty) {
      display: none;
    }
    table {
      border-collapse: collapse;
    }
    table td {
      border: 1px solid black;
      padding: 0.2em;
    }
    table caption {
      text-align: left;
      font-size: large;
      font-family: sans-serif;
      padding-top: 1em;
    }
    progress[value="0"] {display:none;}
    input:invalid {  outline: 2px solid red; }
  </style>

  <script type="module">
    "use strict";

    //import * as mupdf from "./node_modules/mupdf/dist/mupdf.js";
    import * as mupdf from "https://cdn.jsdelivr.net/npm/mupdf/dist/mupdf.js";
    //import QrScanner from './node_modules/qr-scanner/qr-scanner.min.js'; // if using plain es6 import
    import QrScanner from 'https://cdn.jsdelivr.net/npm/qr-scanner/qr-scanner.min.js'; // if using plain es6 import
    
    // attempting to recognize all link patterns from known domain endings
    var linkRegexp = /(?<!@)\b(?:https?:\/\/)?(?:[\p{L}\-_\d]+\.|[\p{L}\-_\d]+[\r\n]{0,2}-[\r\n]{1,2}[\p{L}\-_\d]+\.)+(?:utc|aaa|aarp|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|actor|ad|ads|adult|ae|aeg|aero|aetna|af|afl|africa|ag|agakhan|agency|ai|aig|airbus|airforce|airtel|akdn|al|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|amazon|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|casa|case|cash|casino|cat|catering|catholic|cba|cbn|cbre|cc|cd|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|charity|chase|chat|cheap|chintai|christmas|chrome|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cpa|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dog|domains|dot|download|drive|dtv|dubai|dunlop|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|ericsson|erni|es|esq|estate|et|eu|eurovision|eus|events|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontier|ftr|fujitsu|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gay|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|horse|hospital|host|hosting|hot|hotels|hotmail|house|how|hr|hsbc|ht|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|inc|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|intuit|investments|io|ipiranga|iq|ir|irish|is|ismaili|ist|istanbul|it|itau|itv|jaguar|java|jcb|je|jeep|jetzt|jewelry|jio|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kids|kim|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|link|lipsy|live|living|lk|llc|llp|loan|loans|locker|locus|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|merckmsd|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|moda|moe|moi|mom|monash|money|monster|mormon|mortgage|moscow|moto|motorcycles|mov|movie|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|music|mv|mw|mx|my|mz|na|nab|nagoya|name|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|office|okinawa|olayan|olayangroup|ollo|om|omega|one|ong|onl|online|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|paris|pars|partners|parts|party|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|radio|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|ril|rio|rip|ro|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|sas|save|saxo|sb|sbi|sbs|sc|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|search|seat|secure|security|seek|select|sener|services|seven|sew|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|spa|space|sport|spot|sr|srl|ss|st|stada|staples|star|statebank|statefarm|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|viva|vivo|vlaanderen|vn|vodka|volvo|vote|voting|voto|voyage|vu|wales|walmart|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xihuan|xin|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zm|zone|zuerich|zw)(?:\/?(?=$|[^\p{L}\-\/\?&%#~+=_\d])|\/[\.\p{L}\-\/\?&%#~+=_\d]+)(?:(?<=\/)[\r\n]{1,2}(?=\S+(?:\.htm|\.cgi|\.shtml|\.php|\.pdf|\.doc|\.mp[34]|\.m4a|\.wav|\.zip|\.xls|\.ppt)|[^\s\/\-]+[\/\-])[\.\p{L}\-\/\?&%#~+=_\d]+|(?:(?<=-)[\r\n]{1,2}|[\r\n]{1,2}-[\r\n]{1,2})[\.\p{L}\-\/\?&%#~+=_\d]+)*/gu;
    /*/(?<!@)\b(?:https?:\/\/)?(?:[\p{L}\-_\d]+\.)+(?:utc|aaa|aarp|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|actor|ad|ads|adult|ae|aeg|aero|aetna|af|afl|africa|ag|agakhan|agency|ai|aig|airbus|airforce|airtel|akdn|al|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|amazon|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|casa|case|cash|casino|cat|catering|catholic|cba|cbn|cbre|cc|cd|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|charity|chase|chat|cheap|chintai|christmas|chrome|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cpa|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dog|domains|dot|download|drive|dtv|dubai|dunlop|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|ericsson|erni|es|esq|estate|et|eu|eurovision|eus|events|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontier|ftr|fujitsu|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gay|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|horse|hospital|host|hosting|hot|hotels|hotmail|house|how|hr|hsbc|ht|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|inc|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|intuit|investments|io|ipiranga|iq|ir|irish|is|ismaili|ist|istanbul|it|itau|itv|jaguar|java|jcb|je|jeep|jetzt|jewelry|jio|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kids|kim|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|link|lipsy|live|living|lk|llc|llp|loan|loans|locker|locus|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|merckmsd|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|moda|moe|moi|mom|monash|money|monster|mormon|mortgage|moscow|moto|motorcycles|mov|movie|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|music|mv|mw|mx|my|mz|na|nab|nagoya|name|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|office|okinawa|olayan|olayangroup|ollo|om|omega|one|ong|onl|online|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|paris|pars|partners|parts|party|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|radio|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|ril|rio|rip|ro|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|sas|save|saxo|sb|sbi|sbs|sc|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|search|seat|secure|security|seek|select|sener|services|seven|sew|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|spa|space|sport|spot|sr|srl|ss|st|stada|staples|star|statebank|statefarm|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|viva|vivo|vlaanderen|vn|vodka|volvo|vote|voting|voto|voyage|vu|wales|walmart|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xihuan|xin|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zm|zone|zuerich|zw)(?:(?=\s|$)|\/[\p{L}\-\/\?&%+=_\d]*(?:\r?\n+(?!http|www)[\w\/][^\s\.]+(?:\.ht|\.cg|\/\S+)[\p{L}\d]+)*)/gu;*/

    window.openFile = async function openFile(file) {
      
      console.log("OPEN DOCUMENT", file.name);
      progress.removeAttribute("value");

      let doc = mupdf.Document.openDocument(
        await file.arrayBuffer(),
        file.name
      );

      document.title =
        doc.getMetaData(mupdf.Document.META_INFO_TITLE) || file.name;

      let n = doc.countPages();
      progress.max=n;
      console.log(n);
      
      // if there are multiple values for utm_source-endings, then create an individual pdf for all of them
      var targets = utm_source.value.split(/[,\s]+/g);
      
      // clean information panel
      while (document.body.lastChild.tagName=="A") document.body.lastChild.remove()
      newLinksTable.tBodies[0].replaceChildren();
      normalLinksTable.tBodies[0].replaceChildren();
      localhostLinksTable.tBodies[0].replaceChildren();
      fileLinksTable.tBodies[0].replaceChildren();
      mailLinksTable.tBodies[0].replaceChildren();
      plusLinksTable.tBodies[0].replaceChildren();
      qrLinksTable.tBodies[0].replaceChildren();

      var modifiedLinks = {
        newLinks: [],
        normalLinks: [],
        localhostLinks: [],
        fileLinks: [],
        mailLinks: [],
        plusLinks: [],
        qrLinks: []
      };
      var numPages = doc.countPages();
      var fileChanged = false;
      for (var pageNumber = 0; pageNumber < numPages; pageNumber++) {
        progress.value=pageNumber+1;
        var page = doc.loadPage(pageNumber);
        
        var qrLinks = [];
        // detect QR codes
        if (findQRCodes.checked) {
          let z = 1.98;//3.6; // large enough resolution to detect qr-codes, slightly uneven number so whitespace between blocks disappears (required for proper recognition)
          let pixmap = await page.toPixmap([z,0,0,z,0,0], mupdf.ColorSpace.DeviceGray);
          const offscreen = new OffscreenCanvas(pixmap.getWidth(), pixmap.getHeight());
          const offscreenCtx = offscreen.getContext('2d');
          let png = await pixmap.asPNG();
          let pngBlob = new Blob([png], { type: "image/png" });
          const imageBitmap = await createImageBitmap(pngBlob);
          offscreenCtx.drawImage(imageBitmap, 0, 0);
          offscreenCtx.fillStyle = "white";
          let i=0;
          do {
            i++;
            var result = await QrScanner.scanImage(offscreen, { returnDetailedScanResult: true }).catch(error => {if (i==0) console.log(error || ('No QR code found on page '+(pageNumber+1)))});
            if (typeof result != "undefined") {
              console.log(result);
              // clear rectangle, then run detection again
              offscreenCtx.fillRect(result.cornerPoints[0].x, result.cornerPoints[0].y, result.cornerPoints[2].x-result.cornerPoints[0].x,result.cornerPoints[2].y-result.cornerPoints[0].y);

              //var link = page.createLink([Math.floor(result.cornerPoints[0].x/z), Math.floor(result.cornerPoints[0].y/z), Math.ceil(result.cornerPoints[2].x/z), Math.ceil(result.cornerPoints[2].y/z)], result.data);
              // link found, rectangles are stored
              let uri=result.data;
              linkRegexp.lastIndex = 0;
              if (linkRegexp.test(uri)) {
                uri=(/^https?:\/\//.test(uri)?"":"https://")+uri;
                qrLinks.push({
                  URI: uri,
                  rectangles:[[Math.floor(result.cornerPoints[0].x/z), Math.floor(result.cornerPoints[0].y/z), Math.ceil(result.cornerPoints[2].x/z), Math.ceil(result.cornerPoints[2].y/z)]]
                });  
              } else {
                console.log(pageNumber + 1 + "\t- invalid QR-Code \t" + uri);
              }
              
            }
          } while (typeof result != "undefined")
        }
        
        
        /*let img = new Image()
	      img.src = URL.createObjectURL(new Blob([png], { type: "image/png" }))*/
        
        // trying to recognize link patterns in pdf text, only if option is checked
        if (findLinks.checked) {
          var sText = page.toStructuredText("preserve-whitespace");
          var pText = [];
          var pQuads = [];
          sText.walk({
            endLine: function () {
                pText.push("\n");
                pQuads.push([]);
            },
            endTextBlock: function () {
                pText.push("\n");
                pQuads.push([]);
            },  
            onChar: function (utf, origin, font, size, quad, color) {
                //console.log("onChar", utf, origin, font, size, quad, color);
                pText.push(utf);
                pQuads.push(quad);
              }
          });


          var matches = pText.join("").matchAll(linkRegexp);
          var newLinks = [];

          for (const match of matches) {
            console.log(
              `${pageNumber+1}: Found link in text ${match[0]} start=${match.index} end=${
                match.index + match[0].length
              }.`,
            );
            // link found, rectangles are stored
            newLinks.push({
              URI: (/^https?:\/\//.test(match[0])?"":"https://")+match[0].replace(/-?\r?\n+/g,""),
              rectangles:quadsToRectangles(pQuads.slice(match.index,match.index + match[0].length), 1)
            });
          }
        }
        
        var links = page.getLinks();
        // continue from link pattern detection, remove links that are already linked via pdf structure
        if (findLinks.checked) {
          newLinks = newLinks.filter(newLink => {
            for (const link of links) {
              var linkBounds = link.getBounds();
              for (const rect of newLink.rectangles) {
                if (rectOverlap(linkBounds,rect,-1)) {
                  console.log(`${pageNumber+1}: Link exists already ${newLink.URI}`)
                  return false;
                }
              }
            }
            return true;
          });
          // create new links found via pattern
          if (newLinks.length>0) fileChanged=true;
          newLinks.forEach(newLink => {
            newLink.rectangles.forEach(rect => {
              modifiedLinks.newLinks.push({
                pagenumber: pageNumber + 1,
                page: page,
                link: page.createLink(rect, newLink.URI)
              });
            });
          });
          if (fileChanged) links = page.getLinks();
        }
        
        // continue from QR-code detection, remove links that are already linked via pdf structure
        if (findQRCodes.checked) {
          qrLinks = qrLinks.filter(newLink => {
            for (const link of links) {
              var linkBounds = link.getBounds();
              for (const rect of newLink.rectangles) {
                if (rectOverlap(linkBounds,rect,-1)) {
                  console.log(`${pageNumber+1}: QR-Code-Link exists already ${newLink.URI}`)
                  return false;
                }
              }
            }
            return true;
          });
          // create new links found via pattern
          if (qrLinks.length>0) fileChanged=true;
          qrLinks.forEach(newLink => {
            newLink.rectangles.forEach(rect => {
              modifiedLinks.qrLinks.push({
                pagenumber: pageNumber + 1,
                page: page,
                link: page.createLink(rect, newLink.URI)
              });
            });
          });
          if (fileChanged) links = page.getLinks();
        }
        
        // get links from page
        links=links.filter(link => link.isExternal());
        for (var linkNumber = 0; linkNumber < links.length; linkNumber++) {
          linkRegexp.lastIndex = 0;
          if (/^https?:\/\/localhost/i.test(links[linkNumber].getURI())) { // beook-specific: remove localhost-links
            console.log(pageNumber + 1 + "\t-\t" + links[linkNumber].getURI());
            modifiedLinks.localhostLinks.push({
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            //page.deleteLink(links[linkNumber]);
            //console.log("=> beook Link entfernt.")
            fileChanged = true;
          } else if (/^mailto:/i.test(links[linkNumber].getURI())) { // remove mailto-links
            console.log(pageNumber + 1 + "\t-\t" + links[linkNumber].getURI());
            modifiedLinks.mailLinks.push({
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            //page.deleteLink(links[linkNumber]);
            //console.log("=> mailto Link entfernt.")
            fileChanged = true;
          } else if (/^file:/i.test(links[linkNumber].getURI())) { // remove file-links
            console.log(pageNumber + 1 + "\t-\t" + links[linkNumber].getURI());
            modifiedLinks.fileLinks.push({
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            //page.deleteLink(links[linkNumber]);
            //console.log("=> file Link entfernt.")
            fileChanged = true;
          } else if (!linkRegexp.test(links[linkNumber].getURI())) { // remove suspicious urls
          //else if (!(/(?<!@)\b(?:https?:\/\/)?(?:[\p{L}\-_\d]+\.)+(?:utc|aaa|aarp|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|actor|ad|ads|adult|ae|aeg|aero|aetna|af|afl|africa|ag|agakhan|agency|ai|aig|airbus|airforce|airtel|akdn|al|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|amazon|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|casa|case|cash|casino|cat|catering|catholic|cba|cbn|cbre|cc|cd|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|charity|chase|chat|cheap|chintai|christmas|chrome|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cpa|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dog|domains|dot|download|drive|dtv|dubai|dunlop|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|ericsson|erni|es|esq|estate|et|eu|eurovision|eus|events|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontier|ftr|fujitsu|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gay|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|horse|hospital|host|hosting|hot|hotels|hotmail|house|how|hr|hsbc|ht|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|inc|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|intuit|investments|io|ipiranga|iq|ir|irish|is|ismaili|ist|istanbul|it|itau|itv|jaguar|java|jcb|je|jeep|jetzt|jewelry|jio|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kids|kim|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|link|lipsy|live|living|lk|llc|llp|loan|loans|locker|locus|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|merckmsd|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|moda|moe|moi|mom|monash|money|monster|mormon|mortgage|moscow|moto|motorcycles|mov|movie|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|music|mv|mw|mx|my|mz|na|nab|nagoya|name|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|office|okinawa|olayan|olayangroup|ollo|om|omega|one|ong|onl|online|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|paris|pars|partners|parts|party|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|radio|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|ril|rio|rip|ro|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|sas|save|saxo|sb|sbi|sbs|sc|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|search|seat|secure|security|seek|select|sener|services|seven|sew|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|spa|space|sport|spot|sr|srl|ss|st|stada|staples|star|statebank|statefarm|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|viva|vivo|vlaanderen|vn|vodka|volvo|vote|voting|voto|voyage|vu|wales|walmart|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xihuan|xin|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zm|zone|zuerich|zw)(?:\/?(?=$|[^\p{L}\-\/\?&%#~+=_\d])|\/[\.\p{L}\-\/\?&%#~+=_\d]+)(?:(?<=\/)[\r\n]{1,2}(?=\S+(?:\.htm|\.cgi|\.shtml|\.php)|[^\s\/]+\/)[\.\p{L}\-\/\?&%#~+=_\d]+|(?<=-)[\r\n]{1,2}[\.\p{L}\-\/\?&%#~+=_\d]+)*/gu.test(links[linkNumber].getURI()))) { // remove suspicious urls*/
            console.log(pageNumber + 1 + "\t- invalid\t" + links[linkNumber].getURI());
            modifiedLinks.fileLinks.push({
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            //page.deleteLink(links[linkNumber]);
            //console.log("=> seltsame URL entfernt.")
            fileChanged = true;
          } else if (/^https?:\/\/hep.plus/i.test(links[linkNumber].getURI())) { // hep-specific: adjust hep.plus-links
            //var newURI=links[linkNumber].getURI().replace(/^(https?:\/\/hep.plus\/[^\?]*).*/,"$1?utm_source="+target);
            console.log(pageNumber + 1 + "\t-\t" + links[linkNumber].getURI());
            modifiedLinks.plusLinks.push({
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            //console.log("=> hep.plus-Link modifiziert zu "+newURI);
            //console.log((pageNumber+1)+"\t+\t"+newURI);
            //page.createLink(links[linkNumber].getBounds(),newURI);
            //page.deleteLink(links[linkNumber]);
            fileChanged = true;
          } else {
            modifiedLinks.normalLinks.push({ // keep normal links
              pagenumber: pageNumber + 1,
              page: page,
              link: links[linkNumber],
            });
            console.log(pageNumber + 1 + "\t:\t" + links[linkNumber].getURI());
          }
        }
      }
      
      // update information panel
      modifiedLinks.normalLinks.forEach((element) => {
        let row = normalLinksTable.tBodies[0].insertRow();
        let cell = row.insertCell();
        cell.innerText = element.page.getLabel() || element.pagenumber;
        cell = row.insertCell();
        cell.innerText = element.link.getURI();
      });
      if (fileChanged) {
        modifiedLinks.newLinks.forEach((element) => {
          let row = newLinksTable.tBodies[0].insertRow();
          let cell = row.insertCell();
          cell.innerText = element.page.getLabel() || element.pagenumber;
          cell = row.insertCell();
          cell.innerText = element.link.getURI();
        });
        modifiedLinks.localhostLinks.forEach((element) => {
          element.page.deleteLink(element.link);
          let row = localhostLinksTable.tBodies[0].insertRow();
          let cell = row.insertCell();
          cell.innerText = element.page.getLabel() || element.pagenumber;
          cell = row.insertCell();
          cell.innerText = element.link.getURI();
        });
        modifiedLinks.fileLinks.forEach((element) => {
          element.page.deleteLink(element.link);
          let row = fileLinksTable.tBodies[0].insertRow();
          let cell = row.insertCell();
          cell.innerText = element.page.getLabel() || element.pagenumber;
          cell = row.insertCell();
          cell.innerText = element.link.getURI();
        });
        modifiedLinks.mailLinks.forEach((element) => {
          element.page.deleteLink(element.link);
          let row = mailLinksTable.tBodies[0].insertRow();
          let cell = row.insertCell();
          cell.innerText = element.page.getLabel() || element.pagenumber;
          cell = row.insertCell();
          cell.innerText = element.link.getURI();
        });
        modifiedLinks.qrLinks.forEach((element) => {
          let row = qrLinksTable.tBodies[0].insertRow();
          let cell = row.insertCell();
          cell.innerText = element.page.getLabel() || element.pagenumber;
          cell = row.insertCell();
          cell.innerText = element.link.getURI();
        });
        message.innerText = "Links gefunden. Dateien neu erstellt.";

        // prepare new file for download, create multiple files for hep.plus utm_source variants
        if (modifiedLinks.plusLinks.length > 0) {
          targets.forEach((target, index) => {
            modifiedLinks.plusLinks.forEach((element) => {
              let oldURI = element.link.getURI();
              let newURI = oldURI.replace(
                /^(https?:\/\/hep.plus\/[^\?]*).*/,
                "$1?utm_source=" + target
              );
              let bounds = element.link.getBounds();
              element.page.deleteLink(element.link);
              element.link = element.page.createLink(bounds, newURI);

              if (index == 0) {
                let row = plusLinksTable.tBodies[0].insertRow();
                let cell = row.insertCell();
                cell.innerText = element.page.getLabel() || element.pagenumber;
                cell = row.insertCell();
                cell.innerText = oldURI;
              }
            });
            saveFile(
              typedArrayToBuffer(
                doc.saveToBuffer("").asUint8Array()
              ),
              file.name.replace(/\.pdf$/i, "_" + target + ".pdf"),
              "pdf"
            );
          });
        } else
          saveFile(
            typedArrayToBuffer(doc.saveToBuffer("").asUint8Array()),
            file.name,
            "pdf"
          );
      } else {
        console.log("Datei wurde nicht modifiziert.");
        message.innerText =
          "Keine betroffenen Links gefunden. Datei wurde nicht verändert.";
      }
      fileInput.value = null;
    };
    
    function typedArrayToBuffer(array) {
      return array.buffer.slice(
        array.byteOffset,
        array.byteLength + array.byteOffset
      );
    }
    // save buffer to file
    async function saveFile(plaintext, fileName, fileType) {
      return new Promise((resolve, reject) => {
        const dataView = new DataView(plaintext);
        const blob = new Blob([dataView], { type: fileType });

        if (navigator.msSaveBlob) {
          navigator.msSaveBlob(blob, fileName);
          return resolve();
        } else if (/iPhone|fxios/i.test(navigator.userAgent)) {
          // This method is much slower but createObjectURL
          // is buggy on iOS
          const reader = new FileReader();
          reader.addEventListener("loadend", () => {
            if (reader.error) {
              return reject(reader.error);
            }
            if (reader.result) {
              const a = document.createElement("a");
              // @ts-ignore
              a.href = reader.result;
              a.download = fileName;
              document.body.appendChild(a);
              a.click();
            }
            resolve();
          });
          reader.readAsDataURL(blob);
        } else {
          const downloadUrl = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = downloadUrl;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          URL.revokeObjectURL(downloadUrl);
          setTimeout(resolve, 100);
        }
      });
    }
    
    // create individual rectangles from many quads, merge if they overlap or are so close that they would overlap if they were overlap-points bigger
    function quadsToRectangles(quads, overlap) {
      var rectangles=new Array();
      quads.forEach(quad => {
        var odd=quad.filter((v,i)=>i%2);
        var even=quad.filter((v,i)=>!(i%2))
        rectangles.push([Math.min(...even)-overlap,Math.min(...odd)-overlap,Math.max(...even)+overlap,Math.max(...odd)+overlap]);
      });
      rectangles.forEach((rectangle,i) => {
        if (i>0) {
        let rect=rectOverlap(rectangles[i-1],rectangles[i]);
          if (Array.isArray(rect)) {
            rectangles[i-1]=false;
            rectangles[i]=rect;
          }
        }
      });
      return rectangles.filter(el=>el);
    }
    
    // check if rectangles overlap, if true return merged rectangle
    function rectOverlap(rect1, rect2, overlap = 0) {
        var [x1, y1, x2, y2] = rect1;
        var [x3, y3, x4, y4] = rect2;
        if (x1>x2) [x1,x2]=[x2,x1];
        if (x3>x4) [x3,x4]=[x4,x3];
        if (y1>y2) [y1,y2]=[y2,y1];
        if (y3>y4) [y3,y4]=[y4,y3];

      
        if (x1-overlap > x4 || x2 < x3-overlap || y1-overlap > y4 || y2 < y3-overlap) {
          return false;
        } else {
          return [Math.min(x1,x3),Math.min(y1,y3),Math.max(x2,x4),Math.max(y2,y4)];
        }
    }
  </script>

  <body>
    <input id="fileInput"
      type="file"
      accept=".pdf,.xps,application/pdf"
      onchange="openFile(event.target.files[0])"
    />
    <fieldset>
      <legend>Optionen:</legend>
      <div>
        <input type="checkbox" id="findLinks" name="findLinks" checked />
        <label for="findLinks">Zusätzliche automatische Linkerkennung im PDF durchführen</label>
      </div>
      <div>
        <input type="checkbox" id="findQRCodes" name="findLinks" unchecked />
        <label for="findQRCodes">Zusätzliche Verlinkung von QR-Codes im PDF durchführen [EXPERIMENTELL und langsam]</label>
      </div>
      <div>
        <label for="utm_source">Nur hep.plus-Links: utm_source-Varianten:</label>
        <input type="text" id="utm_source" name="utm_source" placeholder="Komma-getrennte Parameter" pattern="\w+(, ?\w+)*" value="edubase, pdf"/>
        <script>utm_source.oninput = function() {fileInput.disabled = !utm_source.checkValidity();}</script>
      </div>
    </fieldset>

    <div id="pageRoot">
      <div id="message"></div>
      <progress id="progress" max="100" value="0">0%</progress>
      <table id="newLinksTable"><caption>Neu gefundene Weblinks</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
      <table id="normalLinksTable"><caption>Gefundene Weblinks</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
		  <table id="localhostLinksTable"><caption>Gelöschte Localhost-Links</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
		  <table id="fileLinksTable"><caption>Gelöschte File-Links oder verdächtige URLs</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
		  <table id="mailLinksTable"><caption>Gelöschte Mailto-Links</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
      <table id="qrLinksTable"><caption>In QR-Codes gefundene Links</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
		  <table id="plusLinksTable"><caption>Angepasste hep.plus-Links</caption><thead><tr><th>Seite</th><th>URL</th></tr></thead><tbody></tbody></table>
    </div>
  </body>
</html>
